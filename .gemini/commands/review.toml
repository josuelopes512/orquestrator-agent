description = "Revisa a implementação comparando com a spec original. Verifica se faz sentido, se faltou algo, e se segue os padrões definidos."

prompt = """
# Review Implementation

Revise a implementação do plano especificado em: {{args}}

## Propósito

Este comando faz uma revisão crítica e detalhada comparando o que foi planejado na spec com o que foi efetivamente implementado. O objetivo é identificar:

- Itens faltantes ou incompletos
- Divergências entre spec e implementação
- Problemas de arquitetura ou padrão
- Oportunidades de melhoria
- Potenciais bugs ou inconsistências

## Instruções

1. Se `{{args}}` estiver vazio, liste os arquivos disponíveis em `specs/` e pergunte qual revisar
2. Leia o arquivo de spec completo
3. Execute todas as fases de revisão abaixo
4. Gere um relatório detalhado de revisão

## Fases de Revisão

### Fase 1: Inventário de Arquivos

1. Extraia a lista de arquivos da seção "Arquivos a Serem Criados/Modificados" da spec
2. Para cada arquivo:
   - Verifique se existe
   - Leia o conteúdo completo
   - Compare estrutura e conteúdo com o que foi especificado
3. Identifique:
   - Arquivos especificados mas não criados
   - Arquivos criados mas não especificados (extras)
   - Arquivos com implementação divergente

### Fase 2: Análise de Aderência à Spec

Para cada arquivo implementado, compare com os "Detalhes Técnicos" da spec:

1. **Estrutura do Código:**
   - Classes/funções esperadas estão presentes?
   - Assinaturas de métodos conferem?
   - Tipos e validações estão corretos?

2. **Lógica de Negócio:**
   - A implementação segue a lógica descrita na spec?
   - Há divergências no comportamento esperado?
   - Casos de borda foram tratados conforme especificado?

3. **Padrões e Convenções:**
   - Nomenclatura segue o padrão definido?
   - Arquitetura em camadas está sendo respeitada?
   - Imports e dependências estão corretos?

### Fase 3: Verificação de Objetivos

1. Releia a seção "Objetivos" da spec
2. Para cada objetivo listado:
   - Verifique se foi completamente atendido
   - Identifique implementações parciais
   - Avalie se a abordagem faz sentido

3. Classifique cada objetivo:
   - Completo: Totalmente implementado conforme spec
   - Parcial: Implementado mas com lacunas
   - Divergente: Implementado de forma diferente
   - Ausente: Não implementado

### Fase 4: Revisão de Qualidade

Analise criticamente a implementação:

1. **Consistência:**
   - O código é consistente internamente?
   - Os padrões são aplicados uniformemente?
   - Há duplicação de lógica?

2. **Robustez:**
   - Erros são tratados adequadamente?
   - Validações estão presentes onde necessário?
   - Há potenciais pontos de falha?

3. **Legibilidade:**
   - O código é claro e compreensível?
   - Nomes de variáveis/funções são descritivos?
   - Há complexidade desnecessária?

4. **Decisões Arquiteturais:**
   - As decisões da spec foram seguidas?
   - Há decisões que divergem sem justificativa?
   - A arquitetura escolhida faz sentido para o problema?

### Fase 5: Verificação de Testes

Se a spec inclui seção de "Testes":

1. Verifique se os testes especificados existem
2. Analise se cobrem os cenários descritos
3. Identifique testes faltantes
4. Avalie qualidade dos testes implementados

## Formato do Relatório

Gere um relatório estruturado:

```markdown
# Revisão: [nome-da-spec]

## Resumo Executivo

| Aspecto | Status | Observação |
|---------|--------|------------|
| Arquivos | X/Y implementados | [breve nota] |
| Objetivos | X/Y atendidos | [breve nota] |
| Aderência à Spec | Alta/Média/Baixa | [breve nota] |
| Qualidade Geral | Boa/Regular/Ruim | [breve nota] |

## Análise Detalhada

### Arquivos

#### Implementados Conforme Spec
- `arquivo1.py` - OK
- `arquivo2.py` - OK

#### Com Divergências
- `arquivo3.py`
  - **Esperado:** [descrição da spec]
  - **Implementado:** [descrição do que foi feito]
  - **Impacto:** [avaliação do impacto]

#### Faltantes
- `arquivo4.py` - [motivo/impacto]

### Objetivos

#### Atendidos
- [x] Objetivo 1 - Implementado corretamente

#### Parcialmente Atendidos
- [ ] Objetivo 2
  - **Faltando:** [o que falta]
  - **Recomendação:** [como completar]

#### Não Atendidos
- [ ] Objetivo 3
  - **Motivo:** [por que não foi atendido]
  - **Recomendação:** [como implementar]

### Problemas Encontrados

#### Críticos (devem ser corrigidos)
1. **[Título do Problema]**
   - Localização: `arquivo:linha`
   - Descrição: [o que está errado]
   - Impacto: [consequência do problema]
   - Sugestão: [como corrigir]

#### Importantes (deveriam ser corrigidos)
1. ...

#### Menores (podem ser melhorados)
1. ...

### Divergências da Spec

| Item | Spec | Implementação | Avaliação |
|------|------|---------------|-----------|
| [item] | [esperado] | [feito] | [se faz sentido] |

### Pontos Positivos

- [aspectos bem implementados]
- [boas decisões tomadas]
- [melhorias além da spec que agregam valor]

## Recomendações

### Correções Necessárias
1. [ação específica com arquivo/linha]
2. ...

### Melhorias Sugeridas
1. [sugestão de melhoria]
2. ...

### Próximos Passos
1. [ação recomendada]
2. ...

## Conclusão

**Veredito:** [APROVADO / APROVADO COM RESSALVAS / REPROVADO]

[Resumo final com justificativa do veredito]
```

## Regras

- **Sempre** leia a spec original E os arquivos implementados antes de revisar
- **Sempre** seja crítico mas construtivo nas observações
- **Nunca** modifique arquivos durante a revisão (apenas leitura e análise)
- **Compare** detalhadamente spec vs implementação, não apenas checkboxes
- **Avalie** se divergências fazem sentido ou são problemas
- **Sugira** correções específicas com localização no código
- **Reconheça** pontos positivos e boas decisões

## Diferença para /test-implementation

- `/test-implementation`: Foca em executar testes e verificar se o código funciona
- `/review`: Foca em revisar se a implementação está alinhada com a spec e se faz sentido

O `/review` é uma análise mais profunda e crítica, enquanto `/test-implementation` é uma validação técnica de funcionamento.

## Exemplo de Uso

```
/review specs/feature-auth.md
```

O comando irá:
1. Ler a spec completa de `specs/feature-auth.md`
2. Identificar todos os arquivos que deveriam existir
3. Ler e analisar cada arquivo implementado
4. Comparar implementação com os detalhes técnicos da spec
5. Verificar se objetivos foram atendidos
6. Identificar problemas, divergências e lacunas
7. Gerar relatório completo de revisão com recomendações
"""
